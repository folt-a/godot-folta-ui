#-----------------------------------------------------------
#01. tool
#-----------------------------------------------------------
#-----------------------------------------------------------
#02. class_name
#-----------------------------------------------------------
class_name FrameTimer

#-----------------------------------------------------------
#03. extends
#-----------------------------------------------------------
extends Node
#@icon("./frame_timer.svg")
#-----------------------------------------------------------
#04. # docstring
## Timerのフレーム版。
#-----------------------------------------------------------
#-----------------------------------------------------------
#05. signals
#-----------------------------------------------------------
signal timeout
#-----------------------------------------------------------
#06. enums
#-----------------------------------------------------------
#-----------------------------------------------------------
#07. constants
#-----------------------------------------------------------
#-----------------------------------------------------------
#08. exported variables
#-----------------------------------------------------------
@export var wait_frames:int = 1
@export var one_shot:bool = false
@export var auto_start:bool = false
#-----------------------------------------------------------
#09. public variables
#-----------------------------------------------------------
var frame = 0
var is_running:bool = false

#-----------------------------------------------------------
#10. private variables
#-----------------------------------------------------------

#-----------------------------------------------------------
#11. onready variables
#-----------------------------------------------------------

#-----------------------------------------------------------
#12. optional built-in virtual _init method
#-----------------------------------------------------------

#-----------------------------------------------------------
#13. built-in virtual _ready method
#-----------------------------------------------------------

func _ready():
	if auto_start:
		start()
	else:
		set_process(false)
	pass

#-----------------------------------------------------------
#14. remaining built-in virtual methods
#-----------------------------------------------------------
func _process(delta):
	if frame == wait_frames:
		if one_shot:
			stop()
		timeout.emit()
		frame = 0
	frame +=1
#-----------------------------------------------------------
#15. public methods
#-----------------------------------------------------------
func start():
	is_running = true
	frame = 0
	set_process(true)


func stop():
	is_running = false
	set_process(false)


func is_stopped(): return !is_running


func disconnect_timeout_only_connected(callable:Callable):
	if timeout.is_connected(callable):
		timeout.disconnect(callable)
#-----------------------------------------------------------
#16. private methods
#-----------------------------------------------------------

